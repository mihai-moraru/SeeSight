# ──────────────────────────────────────────────────────────────
# CI — Single workflow, three reusable jobs
# ──────────────────────────────────────────────────────────────
#
# The Flutter version is pinned here ONCE and passed to every
# reusable workflow so local ↔ CI formatting never drifts.
#
# When you upgrade locally:
#   1. Run `flutter --version`
#   2. Update FLUTTER_VERSION below
#   3. Run `dart format .` and commit any reformatted files
#
# TODO: Once Dart formatting is stable across releases, replace
#       the pinned version with `channel: stable` in the
#       reusable workflows and remove the version input.
# ──────────────────────────────────────────────────────────────

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

# ── Single source of truth for the Flutter version ───────────
env:
  FLUTTER_VERSION: '3.38.2'

jobs:
  analyze:
    name: Analyze
    uses: ./.github/workflows/analyze.yml
    with:
      flutter-version: '3.38.2'

  test:
    name: Test & Coverage
    needs: analyze
    uses: ./.github/workflows/test.yml
    with:
      flutter-version: '3.38.2'
    secrets: inherit

  format:
    name: Format
    uses: ./.github/workflows/format.yml
    with:
      flutter-version: '3.38.2'
